# Интеграция CEF в XOLO Browser

## Обзор

XOLO Browser теперь использует Chromium Embedded Framework (CEF) вместо стандартного WebView для рендеринга веб-страниц. Это обеспечивает:

- ✅ Полную поддержку Google сервисов (Gmail, YouTube, Google Docs и т.д.)
- ✅ Современный движок Chromium с актуальными веб-стандартами
- ✅ Лучшую производительность и стабильность
- ✅ Поддержку всех современных веб-технологий
- ✅ Отсутствие ограничений iframe/WebView

## Архитектура

### Rust Backend (src-tauri/)

1. **cef_wrapper.rs** - FFI биндинги к CEF библиотеке
   - Инициализация CEF
   - Создание и управление браузерными окнами
   - Обработка событий CEF

2. **cef_commands.rs** - Tauri команды для взаимодействия с CEF
   - `cef_initialize` - инициализация CEF
   - `cef_create_browser` - создание нового браузера
   - `cef_navigate` - навигация по URL
   - `cef_go_back/forward` - история навигации
   - `cef_reload` - перезагрузка страницы
   - И другие команды управления

### Frontend (src/renderer/)

1. **cef-api.ts** - TypeScript API для работы с CEF
   - Обертка над Tauri invoke для удобного использования
   - Типизированные интерфейсы

2. **CefViewContainer.tsx** - React компонент для отображения CEF браузера
   - Замена WebViewContainer
   - Управление жизненным циклом браузера
   - Обработка событий загрузки

## Установка и настройка

### 1. Подготовка CEF библиотек

CEF библиотеки уже находятся в `src-tauri/cef/`. Перед сборкой выполните:

```bash
./setup-cef.sh
```

Этот скрипт скопирует необходимые библиотеки в правильное место.

### 2. Сборка проекта

```bash
# Установка зависимостей
npm install

# Сборка для разработки
npm run tauri dev

# Сборка для продакшена
npm run tauri build
```

## Особенности реализации

### Offscreen Rendering

CEF работает в режиме offscreen rendering (windowless), что позволяет:
- Интегрировать браузер в Tauri окно
- Управлять несколькими вкладками
- Экономить ресурсы системы

### Управление памятью

- Автоматическая заморозка неактивных вкладок
- Ограничение количества активных браузеров
- Очистка ресурсов при закрытии вкладок

### Поддержка Google сервисов

CEF использует полноценный Chromium, поэтому все Google сервисы работают без ограничений:
- Google OAuth авторизация
- Gmail, Google Drive, Google Docs
- YouTube с полной функциональностью
- Google Meet, Google Calendar

## Отличия от WebView/iframe

| Функция | iframe/WebView | CEF |
|---------|---------------|-----|
| Google сервисы | ❌ Ограничены | ✅ Полная поддержка |
| Производительность | ⚠️ Средняя | ✅ Высокая |
| Веб-стандарты | ⚠️ Зависит от системы | ✅ Актуальный Chromium |
| DevTools | ❌ Нет | ✅ Есть |
| Расширения | ❌ Нет | ⚠️ Возможно добавить |
| Размер | ✅ Маленький | ⚠️ ~100MB |

## Известные ограничения

1. **Размер приложения** - CEF добавляет ~100MB к размеру приложения
2. **Первый запуск** - Инициализация CEF может занять несколько секунд
3. **Платформы** - Требуется отдельная сборка CEF для каждой ОС

## Дальнейшее развитие

### TODO

- [ ] Полная реализация всех CEF callbacks
- [ ] Поддержка DevTools для каждой вкладки
- [ ] Кастомные контекстные меню
- [ ] Поддержка загрузок через CEF
- [ ] Поддержка расширений Chrome
- [ ] GPU ускорение
- [ ] Профили пользователей

### Возможные улучшения

1. **Shared texture rendering** - для лучшей производительности
2. **Multi-process architecture** - изоляция вкладок в отдельные процессы
3. **Custom protocol handlers** - для внутренних URL браузера
4. **Network interception** - для блокировки рекламы и трекеров

## Отладка

### Логи CEF

CEF логи можно включить в `cef_wrapper.rs`:

```rust
settings.log_severity = 0; // LOGSEVERITY_VERBOSE
```

### Remote Debugging

CEF запускается с remote debugging на порту 9222:

```
chrome://inspect
```

Или откройте в Chrome: `http://localhost:9222`

## Поддержка

При возникновении проблем:

1. Проверьте, что CEF библиотеки скопированы правильно
2. Убедитесь, что все зависимости установлены
3. Проверьте логи в консоли
4. Откройте issue на GitHub с описанием проблемы

## Ссылки

- [CEF Project](https://bitbucket.org/chromiumembedded/cef)
- [CEF Forum](https://magpcss.org/ceforum/)
- [Chromium Documentation](https://www.chromium.org/developers/)
